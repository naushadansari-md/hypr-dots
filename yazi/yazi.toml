"$schema" = "https://yazi-rs.github.io/schemas/yazi.json"

# ============================================================
# Manager
# ============================================================
[mgr]
ratio          = [ 1, 3, 4 ]
sort_by        = "alphabetical"
sort_sensitive = false
sort_reverse   = false
sort_dir_first = true
sort_translit  = false
linemode       = "none"
show_hidden    = false
show_symlink   = true
scrolloff      = 5
mouse_events   = [ "click", "scroll" ]
title_format   = "Yazi: {cwd}"

# ============================================================
# Preview (Kitty + ueberzugpp optimized)
# ============================================================
[preview]
wrap          = "no"
tab_size      = 2
max_width     = 1600
max_height    = 1600
cache_dir     = "~/.cache/yazi"
image_delay   = 0
image_filter  = "lanczos3"
image_quality = 85

# ============================================================
# Openers
# ============================================================
[opener]

edit = [
  { run = "${EDITOR:-nvim} \"%s\"", desc = "Neovim", for = "linux", block = true },
]

pdf = [
  { run = "zathura -- %S", desc = "Zathura", for = "linux", orphan = true },
]

image = [
  { run = "imv %S", desc = "imv", for = "linux", orphan = true },
]

play = [
  { run = "mpv -- %S", desc = "mpv", for = "linux", orphan = true },
]

open = [
  { run = "xdg-open %S", desc = "xdg-open", for = "linux", orphan = true },
]

reveal = [
  { run = "xdg-open \"%d1\"", desc = "Reveal in file manager", for = "linux", orphan = true },
]

extract = [
  { run = "ya pub extract %s", desc = "Extract here" },
]

# ============================================================
# Open Rules
# ============================================================
[open]
rules = [

  # Directories
  { url = "*/", use = [ "open" ] },

  # Force PDF by filename (important for spaces / mime issues)
  { name = "*.pdf", use = [ "pdf" ] },
  { mime = "application/pdf", use = [ "pdf" ] },

  # Text files
  { mime = "text/*", use = [ "edit" ] },
  { mime = "application/{json,ndjson}", use = [ "edit" ] },
  { mime = "*/javascript", use = [ "edit" ] },

  # Images
  { mime = "image/*", use = [ "image" ] },

  # Audio & Video
  { mime = "{audio,video}/*", use = [ "play" ] },

  # Archives
  { mime = "application/{zip,rar,7z*,tar,gzip,xz,zstd,bzip*,lzma}",
    use = [ "extract" ] },

  # Empty files
  { mime = "inode/empty", use = [ "edit" ] },

  # Fallback
  { url = "*", use = [ "open" ] },
]

# ============================================================
# Tasks
# ============================================================
[tasks]
micro_workers    = 10
macro_workers    = 10
bizarre_retry    = 3
image_alloc      = 1073741824
image_bound      = [ 12000, 12000 ]
suppress_preload = false

# ============================================================
# Plugins
# ============================================================
[plugin]

fetchers = [
  { id = "mime", url = "*/",         run = "mime.dir",    prio = "high" },
  { id = "mime", url = "local://*",  run = "mime.local",  prio = "high" },
  { id = "mime", url = "remote://*", run = "mime.remote", prio = "high" },
]

spotters = [
  { url = "*/", run = "folder" },
  { mime = "text/*", run = "code" },
  { mime = "image/{avif,hei?,jxl}", run = "magick" },
  { mime = "image/svg+xml",         run = "svg" },
  { mime = "image/*",               run = "image" },
  { mime = "video/*", run = "video" },
  { mime = "vfs/*",  run = "vfs" },
  { mime = "null/*", run = "null" },
  { url = "*", run = "file" },
]

preloaders = [
  { mime = "image/{avif,hei?,jxl}", run = "magick" },
  { mime = "image/svg+xml",         run = "svg" },
  { mime = "image/*",               run = "image" },
  { mime = "video/*",         run = "video" },
  { mime = "application/pdf", run = "pdf" },
  { mime = "font/*", run = "font" },
]

previewers = [
  { url = "*/", run = "folder" },
  { mime = "text/*", run = "code" },
  { mime = "application/{json,ndjson}", run = "json" },
  { mime = "image/{avif,hei?,jxl}", run = "magick" },
  { mime = "image/svg+xml",         run = "svg" },
  { mime = "image/*",               run = "image" },
  { mime = "video/*",         run = "video" },
  { mime = "application/pdf", run = "pdf" },
  { mime = "application/{zip,rar,7z*,tar,gzip,xz,zstd,bzip*,lzma}",
    run = "archive" },
  { mime = "inode/empty", run = "empty" },
  { mime = "vfs/*",  run = "vfs" },
  { mime = "null/*", run = "null" },
  { url = "*", run = "file" },
]

# ============================================================
# UI
# ============================================================
[input]
cursor_blink = false

[confirm]
trash_title  = "Trash {n} selected file{s}?"
delete_title = "Permanently delete {n} selected file{s}?"

[which]
sort_by        = "none"
sort_sensitive = false
sort_reverse   = false
sort_translit  = false
